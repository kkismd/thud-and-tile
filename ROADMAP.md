# Development Roadmap

## 🎯 現在の状況: メカニクス改善計画完成・実装準備完了

### 最新の状況 (2025-10-04)
**Phase 2D**: メカニクス改善計画策定完了。新スコアシステム・CHAIN-BONUS・Solidライン相殺機能の設計確定。  
**結論**: 実装に向けた技術仕様完成、TDDサイクルでの実装準備完了。

**完了済み項目:**
- ✅ SRS True Rotation実装とCLI/Web統一 (Phase 2A)
- ✅ 統一アーキテクチャ第1回実装試行とレトロスペクティブ (Phase 2B)
- ✅ **Issue #4, #5バグ修正完了** (Phase 2C)
- ✅ **SHAPES配列、7-bag、隣接制約チェック共通化** (Phase 2C)
- ✅ **Web版テスト強化（95/95テスト成功）** (Phase 2C)
- ✅ **技術的負債解消とAPI整理** (Phase 2C)
- ✅ **メカニクス改善計画策定完了** (Phase 2D)
  - ✅ スコアシステム改修計画（ColorScores → total_score統一）
  - ✅ CHAIN-BONUSシステム設計
  - ✅ Solidライン相殺機能（EraseLine）設計
  - ✅ アニメーションシーケンス詳細化
  - ✅ 実装ステップ明確化

## 🚀 次のステップ (優先度順)

### 🏆 Priority 0: メカニクス改善計画実装 (最優先)
**推定時間:** 1-2週間  
**アプローチ:** TDDサイクルによる段階的実装  
**基盤:** ✅ メカニクス改善計画完成、技術仕様確定済み

**実装計画:**
1. `ColorMaxChains`に`chain_bonus`メンバ追加
2. `CustomScoreSystem`の`ColorScores`を`total_score: u32`に置換
3. スコア計算ロジックの変更（直接合計値加算方式）
4. 既存テストの修正（約15個のテスト対象）
5. `EraseLine`アニメーション追加（Solidライン相殺機能）

**実装方針:** CLI版での完全実装 → Web版キャッチアップ
- **Phase 1:** CLI版（main.rs）での機能実装完成
- **Phase 2:** Web版（lib.rs）への機能移植とテスト統合

**詳細:** [メカニクス改善計画](./mechanics_improve_plan.md)参照

### Priority 0.5: Web版メカニクス改善キャッチアップ
**推定時間:** 3-5日  
**前提条件:** CLI版メカニクス改善実装完了  
**アプローチ:** CLI版実装を基にしたWeb版への機能移植

**実装計画:**
1. CLI版で完成した新機能のWeb版移植
2. WASM対応のテスト追加・修正
3. Web版UI更新（新スコア表示、CHAIN-BONUS表示）
4. CLI・Web版の機能等価性確認
5. 統合テストでの回帰防止確認

### Priority 1: 統一アーキテクチャ第2回実装
**推定時間:** 2-3日  
**アプローチ:** テスト駆動開発 + 段階的移行  
**基盤:** ✅ 安定したコードベース確立済み

**実装計画:**
1. GameStateAccess trait の最小実装設計
2. Red-Green-Refactorサイクルでの段階的実装
3. 既存95テストでの機能退行防止
4. CLI・Web版での統一レンダリング実現

### Priority 2: 統一レンダリングシステム
**推定時間:** 2-3日  
**目的:** draw_unified()による描画統一

**実装項目:**
- 共通レンダリングインターフェース設計
- CLI版crossterm → 統一API移行
- Web版Canvas → 統一API移行
- 差分レンダリング最適化保持

### Priority 3: 高度な機能統一化
**推定時間:** 3-4日  
**方針:** 基本機能確立後の拡張

**統一対象:**
- アニメーションシステム（Push Down, Line Blink）
- スコアリングシステム
- 入力処理システム
- 状態管理システム

---

## 📋 Phase 2B: テスト駆動統一アーキテクチャ実装
**推定期間:** 2-3週間  
**方針:** レトロスペクティブ分析に基づく改善アプローチ

### 実装品質向上
- [ ] 既存機能の包括的テストスイート作成
- [ ] Red-Green-Refactorサイクルの厳格な適用
- [ ] 各機能の段階的移行（big bang approach回避）
- [ ] 機能回帰防止の自動テスト

### 統一アーキテクチャ再実装
- [ ] GameStateAccess trait の最小設計
- [ ] CLI/Web エンジンの段階的統一
- [ ] レンダリングシステムの慎重な統合
- [ ] 既存機能保持の確認テスト

### コード品質向上
- [ ] テスタビリティ重視の設計
- [ ] 複雑な依存関係の分離
- [ ] モックとスタブの活用
- [ ] 継続的な品質測定

---

## 📋 Phase 3: 統一アーキテクチャ完成とポリッシュ
**推定期間:** 2-3週間

### 統一システム完成
- [ ] CLI/Web版の完全な機能等価性達成
- [ ] パフォーマンス最適化と品質向上
- [ ] クロスブラウザ互換性確認
- [ ] プロダクション準備完了

### 高度機能実装
- [ ] Save/Load機能
- [ ] 難易度設定システム
- [ ] サウンド効果統合
- [ ] 高度な統計追跡

---

## 🚀 Quick Start Next Action

**レトロスペクティブ文書参照:**
```bash
# 第1回実装の教訓確認
cat UNIFIED_ARCHITECTURE_RETROSPECTIVE.md

# 次回実装の準備開始
# 1. 既存機能の動作確認
cargo run
cd ../thud-and-tile-web && npm run dev

# 2. テスト作成の計画立案
# - 重要機能の識別
# - テスト設計方針検討
# - Red-Green-Refactorサイクル準備
```

**重要リンク:**
- [統一アーキテクチャレトロスペクティブ](./UNIFIED_ARCHITECTURE_RETROSPECTIVE.md)
- [実装履歴](./HISTORY.md)